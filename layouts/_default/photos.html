<!DOCTYPE html>
<html lang="de">

<head>
  {{- partial "head.html" . -}}
  <meta name="description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
  <meta property="og:title" content="{{ .Site.Params.homepage_meta_tags.meta_og_title }}" />
  <meta property="og:type" content="{{ .Site.Params.homepage_meta_tags.meta_og_type }}" />
  <meta property="og:url" content="{{ .Site.Params.homepage_meta_tags.meta_og_url }}" />
  <meta property="og:image" content="{{ .Site.Params.homepage_meta_tags.meta_og_image }}" />
  <meta property="og:description" content="{{ .Site.Params.homepage_meta_tags.meta_og_description }}" />
  <meta name="twitter:card" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_card }}" />
  <meta name="twitter:site" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_site }}" />
  <meta name="twitter:creator" content="{{ .Site.Params.homepage_meta_tags.meta_twitter_creator }}" />

  <link rel="stylesheet" href="/css/photos.css" />
</head>
<body>

{{ $isGerman := eq .Language.LanguageName "Deutsch" }}

{{- partial "alert.html" . -}}

{{- partial "header.html" . -}}

<div class="mx-auto my-10 max-w-6xl">

    <h1 class="title text-5xl font-bold mb-3">{{.Title}}</h1>

    <p>{{ .Content }}</p>

    <div class="content py-1">{{.Content}}</div>

    <div class="scroll-top rounded-full">
        <span class="icon-keyboard_arrow_up text-2xl"></span>
    </div>


    <div class="image-grid">
        {{ range sort (readDir "static/img/photos/") "Name" }}
        {{ if (findRE ".jpg$" .Name) }}
        <div class="image-item">
            <img src="/img/photos/{{ .Name }}">
        </div>
        {{ end }}
        {{ end }}
    </div>

    <div class="overlay">
        <span class="close-button" onclick="closeOverlay()">&times;</span>
        <div class="imgs-wrapper">
            <img class="arrow-button" src="/img/left-arrow.svg">
            <img id="overlay-image" src="" alt="Overlay Image">
            <img class="arrow-button" src="/img/right-arrow.svg">
        </div>
    </div>

    <script>
        const imageItems = document.querySelectorAll('.image-item');
        const imgs = [...imageItems].map(item => item.getElementsByTagName("img")[0]);
        const overlay = document.querySelector('.overlay');
        const overlayImage = document.getElementById('overlay-image');
        let currentUsedImgIndex = NaN;
        let currentlyUsedImg = null;

        imageItems.forEach((item, index) => {
            const img =  item.getElementsByTagName("img")[0];
            const splitImgUrl = img.src.split("/");
            const imgFileName = splitImgUrl[splitImgUrl.length - 1];

            item.addEventListener("click", () => {
                overlayImage.src = `/img/photos/${imgFileName}`;
                overlay.style.display = 'block';
                getCurrentImgIndex()
                // currentUsedImgIndex = index;
                currentlyUsedImg = img;
            });
        });

        const closeOverlay = () => overlay.style.display = 'none';

        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) {
                closeOverlay();
            }
        });
        
        const getCurrentImg = () => {
            const currentImgFileName = overlayImage.src.split("/").slice(-1)[0];
            return imgs.filter(img => {
                const iteratedImgFileName = img.src.split("/").slice(-1)[0];
                return iteratedImgFileName === currentImgFileName;
            })[0];
        };

        const getMaxImgIndex = () => {
            let highest = 0;
            imgs.forEach(img => {
                const imgName = img.src.split("/").slice(-1)[0];
                const imgNumber = parseInt(imgName.match(/\d+/)[0]);
                highest = imgNumber > highest ? imgNumber : highest;
            });
            
            return highest;
        };

        const getCurrentImgIndex = () => {
            const currentImgFileName = overlayImage.src.split("/").slice(-1)[0];
            let number = parseInt(currentImgFileName.match(/\d+/)[0]);
            return number;
        };

        const [leftArrow, rightArrow] = document.getElementsByClassName("arrow-button");
        
        leftArrow.addEventListener("click", () => {
            const currentIndex = getCurrentImgIndex();
            const newIndex = currentIndex - 1 < 1 ? getMaxImgIndex() : currentIndex - 1;

            overlayImage.src = `/img/photos/image${newIndex}.jpg`;
        });

        rightArrow.addEventListener("click", () => {
            const currentIndex = getCurrentImgIndex();
            const newIndex = currentIndex + 1 > imageItems.length - 1
                ? 0
                : currentIndex + 1;
            overlayImage.src = `/img/photos/image${newIndex + 1}.jpg`;
            currentUsedImgIndex = newIndex;
        });
    </script>
    </div>

  {{- partial "footer.html" . -}}
</body>
{{/* These values are set dynamically to adjust the calculator to the language. */}}
{{- if $isGerman }}
<script>const LANGUAGE = "Deutsch"</script>
{{- else }}
<script>const LANGUAGE = "English"</script>
{{- end }}
</html>